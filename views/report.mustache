<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <title>Products</title>

    <style type="text/css">
    body{
       background-color : #F0F0F0;
    }
	.design{
        background-color: white;
        padding-top: 10px;
        border: solid grey 1px;
        width: 65%;
        padding-bottom: 10px;
	-webkit-box-shadow: 0 3px 2px #777;
	-moz-box-shadow: 0 3px 2px #777;
	box-shadow: 0 3px 2px #777;
}
</style>
  </head>
  <body>

   <nav class="navbar navbar-expand-lg navbar-dark bg-dark static-top">
      <div class="container">
        <a class="navbar-brand" href="#">Application</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item active">
              <a class="nav-link" href="#">Home
                <span class="sr-only">(current)</span>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Services</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Contact</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>


    <!-- Page Content -->
    <br><br>
    <div class="container ">
    <div class="row">
        <div class="col-lg-12 text-center design">

                <table class="table table-bordered">
                  <thead class="thead-dark">
    <tr>
      <th scope="col">Ref No.</th>
      <th scope="col">Request By</th>
      <th scope="col">Method</th>
      <th scope="col">Amount</th>
    </tr>
  </thead>

  <tbody>

    

    {{#data}}
               
      <tr class="showrow">
      <th scope="row">{{refno}}</th>
      <td>{{reqby}}</td>
      <td>{{method}}</td>
      <td>{{amount}}</td>
      <td><a href="/report/{{_id}}" class="btn btn-danger">x</a></td>
    <td><a href="#" class="btn btn-success view">View</a></td>
    </tr>
    <tr style="display:none;">
    <td bgcolor="#778899" colspan="4">
    
    <table class="table">
  <thead class="thead-light">
    <tr>
      <th scope="col">Expense Code</th>
      <th scope="col">Expense Name</th>
      <th scope="col">Amount</th>
    </tr>
  </thead>
  <tbody>
  {{#expense}}
    <tr >
      <th scope="row">
      {{code}}
      </th>
      <td>
      {{name}}
      </td>
      <td>
      {{amount}}
      </td>
     
    </tr>
  
    {{/expense}}
    </tbody>
    </table>
    </td>
    </tr>
    {{/data}}
    
    
  </tbody>
</table>
                </div></div>
                </br></br>

      <div class="row">
        <div class="col-lg-12 text-center">
           
                 <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
  Add +
</button>
        </div>
       
       </div>
        
    </div>
    
</br></br>

  
 

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Petty Cash Reimbursement Form</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form action="http://localhost:1238/report" method="POST">
  <div class="form-group">
    <label for="refno">Ref No :</label>
    <input type="text" class="form-control" id="refno" name="refno" value="{{newref}}">
  </div>
  <div class="form-group">
    <label for="price">Reimbursement by :</label>
    <input type="text" class="form-control" id="method" name="method" list="methods" data-list="{'valueCompletion': true, 'highlight': true}">
    <datalist id="methods">
   
        <option value='cash'>cash</option>
        <option value='cheque'>cheque</option>
   
    </datalist>
  </div>
   <div class="form-group">
    <label for="country">Requested By :</label>
    <input type="text" class="form-control" id="reqby" name="reqby" >
  </div>


    <table class="table" id="expenses" name="expenses">
  <thead class="thead-dark">
    <tr>
      <th scope="col">Expense Code</th>
      <th scope="col">Expense Name</th>
      <th scope="col">Amount</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th scope="row">
      <input type="text" class="form-control" id="exp1code" name="exp1code">
      </th>
      <td>
      <input type="text" class="form-control" id="exp1name" name="exp1name">
      </td>
      <td>
      <input type="number" step=0.01 class="form-control amt" id="exp1amt" name="exp1amt">
      </td>
      <td>
      <div class="btn btn-small btn-danger delbtn"> X </div>
      </td>
    </tr>
  
    <tr>
      <th scope="row">Total Amount</th>
      <td align="right" >Dollar</td>
      <td >
        <input type="text" class="form-control" id="totalAmt" name="totalAmt" readonly="readonly" >
      </td>
      <td>
       <div id='addfield' name='addfield' class='btn btn-success'>
    Add +
 </div>
      </td>
    </tr>
        <tr>
      <th scope="row">Total Amount Words</th>
      <td  colspan="2">
      <textarea class="form-control" id="totalAmtWords" name="totalAmtWords" readonly="readonly" >
      </textarea>
      </td>

      
    </tr>
  </tbody>
</table>

 
  
  <button type="submit" class="btn btn-success">Submit</button>
</form>
      </div>
      <div class="modal-footer">
        
      </div>
    </div>
  </div>
</div>




        </div>
      
    </div>
    

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script>
    $(document).ready(function() {
      /*
      $(".showrow").click(function(){
        $(this).next().toggle('slow');
      });
  */
      $(".view").click(function(){
        $(this).closest('tr').next().toggle('slow');
        
      });

    $("#addfield").click(function() {
        
        var index = $('#expenses tr:last').prev().prev().index();
        console.log(index);
        index = index + 2;
        $('#expenses tr:last').prev().before(`<tr><th scope='row'><input type='text' class='form-control' id='exp${index}code' name='exp${index}code'>
      </th>
      <td>
      <input type='text' class='form-control' id='exp${index}name' name='exp${index}name'>
      </td>
      <td>
      <input type='number' step=0.01 class='form-control amt' id='exp${index}amt' name='exp${index}amt'>
      </td>
      <td>
      <div class="btn btn-small btn-danger delbtn"> X </div>
      </div>
    </tr>`
        );

});


    });

    $("#expenses").on('focusout', '.amt',function(){
   addingPrice();

});

function addingPrice(){
 var sum = 0.0;
     $('.amt').each(function() {
         var value = $(this).val();
         if(value !== "" )
         {
         sum = parseFloat(sum);
         value = parseFloat(value);
        sum += value;

        sum = sum.toFixed(2);
         }
       
    });

    
    
    
    $("#totalAmt").val(sum);
    $("#totalAmtWords").val("");
    console.log(sum);
    if(sum.toString().indexOf('.') !== -1 )
    {
      var splitval = sum.toString().split(".");
      if(sum.toString().indexOf('.00') === -1)
      {
      $("#totalAmtWords").val(inWords(splitval[0])+" Dollars And "+inWords(splitval[1])+" cents");
      }
      else
      {
        $("#totalAmtWords").val(inWords(splitval[0])+" Dollars");
      }
    }
    else if(!isNaN(sum) && sum != 0)
    {
      $("#totalAmtWords").val(inWords(sum)+" Dollars ");
    }
   
}

$("#expenses").on('click', '.delbtn',function(){

  
   $(this).closest('tr').remove();
   addingPrice();

});

var a = ['','One ','Two ','Three ','Four ', 'Five ','Six ','Seven ','Eight ','Nine ','Ten ','Eleven ','Twelve ','Thirteen ','Fourteen ','Fifteen ','Sixteen ','Seventeen ','Eighteen ','Nineteen '];
var b = ['', '', 'Twenty','Thirty','Forty','Fifty', 'Sixty','Seventy','Eighty','Ninety'];

function inWords (num) {
    if ((num = num.toString()).length > 9) return 'overflow';
    n = ('000000000' + num).substr(-9).match(/^(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})$/);
    if (!n) return; var str = '';
    str += (n[1] != 0) ? (a[Number(n[1])] || b[n[1][0]] + ' ' + a[n[1][1]]) + 'crore ' : '';
    str += (n[2] != 0) ? (a[Number(n[2])] || b[n[2][0]] + ' ' + a[n[2][1]]) + 'lakh ' : '';
    str += (n[3] != 0) ? (a[Number(n[3])] || b[n[3][0]] + ' ' + a[n[3][1]]) + 'thousand ' : '';
    str += (n[4] != 0) ? (a[Number(n[4])] || b[n[4][0]] + ' ' + a[n[4][1]]) + 'hundred ' : '';
    str += (n[5] != 0) ? ((str != '') ? 'and ' : '') + (a[Number(n[5])] || b[n[5][0]] + ' ' + a[n[5][1]]) + '' : '';
    return str;
}
    </script>
  </body>
</html>